{% extends 'base.html.twig' %}

{% block title %}Inscription{% endblock %}

{% block body %}
    <section class="section">
        <div class="container">
            <h1 class="title">Créer un compte</h1>

            {# Flash erreurs globales #}
            {% for flash_error in app.flashes('error') %}
                <div class="notification is-danger">
                    {{ flash_error }}
                </div>
            {% endfor %}

            {{ form_start(registrationForm, { 'attr': { 'class': 'box' } }) }}

            <div class="columns">
                <div class="column">
                    <div class="field">
                        {{ form_label(registrationForm.nom, 'Nom', { 'label_attr': { 'class': 'label' } }) }}
                        <div class="control">
                            {{ form_widget(registrationForm.nom, { 'attr': { 'class': 'input' } }) }}
                        </div>
                        {% for error in registrationForm.nom.vars.errors %}
                            <p class="has-text-danger is-size-7">{{ error.message }}</p>
                        {% endfor %}
                    </div>
                </div>

                <div class="column">
                    <div class="field">
                        {{ form_label(registrationForm.prenom, 'Prénom', { 'label_attr': { 'class': 'label' } }) }}
                        <div class="control">
                            {{ form_widget(registrationForm.prenom, { 'attr': { 'class': 'input' } }) }}
                        </div>
                        {% for error in registrationForm.prenom.vars.errors %}
                            <p class="has-text-danger is-size-7">{{ error.message }}</p>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="columns">
                <div class="column">
                    <div class="field">
                        {{ form_label(registrationForm.pseudo, 'Pseudo', { 'label_attr': { 'class': 'label' } }) }}
                        <div class="control">
                            {{ form_widget(registrationForm.pseudo, { 'attr': { 'class': 'input' } }) }}
                        </div>
                        {% for error in registrationForm.pseudo.vars.errors %}
                            <p class="has-text-danger is-size-7">{{ error.message }}</p>
                        {% endfor %}
                    </div>
                </div>

                <div class="column">
                    <div class="field">
                        {{ form_label(registrationForm.email, 'Email', { 'label_attr': { 'class': 'label' } }) }}
                        <div class="control">
                            {{ form_widget(registrationForm.email, { 'attr': { 'class': 'input' } }) }}
                        </div>
                        {% for error in registrationForm.email.vars.errors %}
                            <p class="has-text-danger is-size-7">{{ error.message }}</p>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="columns">
                <div class="column">
                    <div class="field">
                        {{ form_label(registrationForm.telephone, 'Téléphone', { 'label_attr': { 'class': 'label' } }) }}
                        <div class="control">
                            {{ form_widget(registrationForm.telephone, { 'attr': { 'class': 'input' } }) }}
                        </div>
                        {% for error in registrationForm.telephone.vars.errors %}
                            <p class="has-text-danger is-size-7">{{ error.message }}</p>
                        {% endfor %}
                    </div>
                </div>

                <div class="column">
                    <div class="field">
                        {{ form_label(registrationForm.campus, 'Campus', { 'label_attr': { 'class': 'label' } }) }}
                        <div class="control">
                            {{ form_widget(registrationForm.campus, { 'attr': { 'class': 'input' } }) }}
                        </div>
                        {% for error in registrationForm.campus.vars.errors %}
                            <p class="has-text-danger is-size-7">{{ error.message }}</p>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="field">
                {{ form_label(registrationForm.plainPassword, 'Mot de passe', { 'label_attr': { 'class': 'label' } }) }}
                <div class="control">
                    {{ form_widget(registrationForm.plainPassword, { 'attr': { 'class': 'input' } }) }}
                </div>
                {% for error in registrationForm.plainPassword.vars.errors %}
                    <p class="has-text-danger is-size-7">{{ error.message }}</p>
                {% endfor %}
            </div>
            <div class="column is-4">
                <div class="box">
                    <div class="field">
                        {{ form_label(registrationForm.urlPhoto, 'Photo de profil', { 'label_attr': { 'class': 'label' } }) }}
                        <div class="file has-name is-fullwidth">
                            <label class="file-label">
                                {{ form_widget(registrationForm.urlPhoto, { 'attr': { 'class': 'file-input photo-file-input' } }) }}
                                <span class="file-cta">
                                        <span class="file-icon">
                                            <i class="fas fa-upload"></i>
                                        </span>
                                        <span class="file-label">
                                            Choisir une photo
                                        </span>
                                    </span>
                                <span class="file-name" id="file-name-display">
                                        Aucun fichier choisi
                                    </span>
                            </label>
                        </div>
                        <p class="help">Formats acceptés : JPEG, PNG - 1Mo maximum</p>
                        {% for error in registrationForm.urlPhoto.vars.errors %}
                            <p class="has-text-danger is-size-7">{{ error.message }}</p>
                        {% endfor %}
                    </div>
                    <div class="mt-4">
                        <figure class="image is-128x128 mx-auto">
                            <img class="is-rounded" src="{{ asset('uploads/photos/défaut.png') }}" alt="Photo de profil par défaut">
                        </figure>
                        <p class="has-text-centered mt-2 is-size-7">Image par défaut</p>
                    </div>
                </div>
            </div>
        </div>

            <div class="field">
                <div class="control">
                    <button type="submit" class="button is-success is-fullwidth">S'inscrire</button>
                </div>
            </div>

            {{ form_end(registrationForm) }}

            <p class="mt-4">Déjà un compte ? <a href="{{ path('app_login') }}">Se connecter</a></p>
        </div>
    </section>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const fileInput = document.querySelector('.photo-file-input');
            const fileNameDisplay = document.getElementById('file-name-display');

            if (fileInput) {
                fileInput.addEventListener('change', function () {
                    if (fileInput.files.length > 0) {
                        fileNameDisplay.textContent = fileInput.files[0].name;
                    } else {
                        fileNameDisplay.textContent = "Aucun fichier choisi";
                    }
                });
            }
        });
    </script>
{% endblock %}